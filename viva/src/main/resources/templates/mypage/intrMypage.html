<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <script src="https://code.jquery.com/jquery-latest.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <meta charset="UTF-8">
  <title>면접관 마이페이지</title>
  <link rel="stylesheet" th:href="@{/css/main.css}">
  <link rel="stylesheet" th:href="@{/css/common.css}">
  
  <style>
    body {
      background: #f7f9fc;
      font-family: 'Segoe UI', '맑은 고딕', sans-serif;
      margin: 0;
      padding: 0;
    }
    .mypage-layout {
      display: flex;
      max-width: 1100px;
      margin: 50px auto 0 auto;
      min-height: 550px;
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 2px 14px rgba(70,110,180,0.08);
      overflow: hidden;
    }
    /* 사이드바 */
    .sidebar {
      width: 230px;
      background: #eaf1fb;
      padding: 36px 0 0 0;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .sidebar-menu {
      display: flex;
      flex-direction: column;
      gap: 5px;
      padding-left: 24px;
    }
    .sidebar-menu a {
      font-size: 17px;
      color: #314266;
      text-decoration: none;
      padding: 10px 0 10px 12px;
      border-radius: 5px 0 0 5px;
      transition: background 0.18s;
      font-weight: 500;
      letter-spacing: -0.2px;
    }
    .sidebar-menu a.active,
    .sidebar-menu a:hover {
      background: #c3d3ee;
      color: #2951a3;
      font-weight: bold;
    }
    .sidebar-bottom {
      padding-left: 24px;
      padding-bottom: 38px;
    }
    .sidebar-bottom a {
      color: #d34040;
      font-weight: bold;
      text-decoration: none;
      font-size: 15px;
      transition: color 0.2s;
    }
    .sidebar-bottom a:hover {
      color: #b80000;
      text-decoration: underline;
    }
    /* 메인컨텐츠 */
    .main-content {
      flex: 1;
      padding: 46px 44px;
      background: #f7f9fc;
      min-width: 0;
    }
    .info-cards {
      display: flex;
      gap: 36px;
    }
    .member-info {
      background: #fff;
      border-radius: 9px;
      box-shadow: 0 2px 8px rgba(135,160,180,0.07);
      padding: 32px 38px 30px 38px;
      min-width: 320px;
      flex: 1;
      margin-bottom: 24px;
    }
    .member-info h2 {
      margin-top: 0;
      font-size: 21px;
      color: #314266;
      margin-bottom: 16px;
    }
    .member-info-list {
      font-size: 16px;
      line-height: 2.1;
      color: #222;
    }
    .stat-info {
      background: #eaf1fb;
      border-radius: 9px;
      box-shadow: 0 2px 8px rgba(70,110,180,0.06);
      padding: 32px 40px;
      min-width: 220px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      margin-bottom: 24px;
    }
    .stat-info h2 {
      margin-top: 0;
      font-size: 20px;
      color: #2951a3;
      margin-bottom: 18px;
    }
    .stat-info .point-value {
      font-size: 25px;
      color: #314266;
      font-weight: bold;
      margin-bottom: 8px;
    }
    @media (max-width: 900px) {
      .mypage-layout { flex-direction: column; }
      .sidebar { width: 100%; flex-direction: row; padding: 0; }
      .main-content { padding: 24px 10px; }
      .info-cards { flex-direction: column; gap: 14px; }
    }
  </style>
</head>
<body>
<div th:replace="fragments/header :: header"></div>

  <div class="mypage-layout">
    <!-- 사이드바 -->
    <nav class="sidebar">
      <div>
        <div class="sidebar-menu">
          <a href="#" class="active">내 정보</a>
          <a th:href="@{/memberEdit}">내 정보 수정</a>
          <a href="#">후기 관리</a>
         <a href="#" id="menuSchedule">일정 관리</a><!-- 이슬 수정 -->
          <a href="#">이력서 관리</a>
          <a th:href="@{/jobsite}">취업 사이트</a>
        </div>
      </div>
      <div class="sidebar-bottom">
      	<!-- 페이지 이동 없이 자바스크립트로만 동작 -->
        <a href="#" id="withdrawBtn" style="color:#d34040; text-decoration:underline;">회원 탈퇴</a>
      </div>
    </nav>

    <!-- 메인 컨텐츠 -->
    <section class="main-content" id="contentArea"><!--id="contentArea" 추가-s -->
      <div class="info-cards">
        <!-- 회원 정보 -->
        <div class="member-info">
          <h2>회원 정보</h2>
          <div class="member-info-list">
            <div><strong>아이디:</strong> <span th:text="${users.userId}">intr1</span></div>
            <div><strong>이름:</strong> <span th:text="${users.userName}">홍면접</span></div>
            <div><strong>핸드폰번호:</strong> <span th:text="${users.userNum}">010-0000-0000</span></div>
            <div><strong>이메일:</strong> <span th:text="${users.userEmail}">intr@naver.com</span></div>
            <div><strong>주소:</strong> <span th:text="${users.userAdd + ' ' + users.userAddDetail}">주소+상세주소</span></div>
            <div><strong>가입일:</strong> <span th:text="${users.createdDt}">2025-06-27</span></div>
          </div>
        </div>
        <!-- 포인트만 표시하는 활동통계 -->
        <div class="stat-info">
          <h2>나의 포인트</h2>
           <div class="point-value" th:text="${point + 'P'}">
          <!--  <div th:text="${point + 'P'}"></div> -->
           	</div>	
        </div> 
      </div>
       <!-- ✅ 일정 관리 영역 (Ajax로 로드) -->
  <div id="contentArea"><!-- 여기에 fragment가 동적으로 들어옴 --></div>
    </section>
  </div>
  
  
 <!-- 탈퇴 팝업 Modal (처음에는 display:none; 숨겨둠) -->
<div id="withdrawModal" style="display:none; position:fixed; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.25); z-index:9999;">
  <div style="background:#fff; width:350px; margin:120px auto; padding:32px 24px 16px 24px; border-radius:10px; box-shadow:0 4px 24px rgba(0,0,0,0.16); position:relative;">
    <h2 style="margin-bottom:18px;">정말로 탈퇴하시겠습니까?</h2>
    <form id="withdrawForm">
      <!-- 비밀번호 입력 -->
      <div style="margin-bottom:10px;">
        <label>현재 비밀번호</label><br>
        <input type="password" name="currentPass" style="width:100%;" required />
      </div>
      <div style="margin-bottom:18px;">
        <label>비밀번호 확인</label><br>
        <input type="password" name="confirmPass" style="width:100%;" required />
      </div>
      <!-- 버튼 영역 -->
      <div style="display:flex; justify-content:space-between;">
        <button type="submit" style="background:#d34040; color:#fff; border:none; padding:7px 20px; border-radius:5px;">확인</button>
        <button type="button" id="cancelWithdraw" style="background:#ccc; color:#222; border:none; padding:7px 20px; border-radius:5px;">취소</button>
      </div>
    </form>
  </div>
</div>
  
  <!-- 회원정보 수정 후 메세지 -->
<script th:if="${editSuccess != null}" th:inline="javascript">
	 alert('[[${editSuccess}]]');
</script>
  
  
<script>
$(function(){
  // 1. "회원 탈퇴" 링크 클릭 시 팝업 열기
  $("#withdrawBtn").on("click", function(e){
    e.preventDefault(); // 링크 기본동작 막기(새로고침X)
    $("#withdrawModal").show();
  });

  // 2. 취소 버튼 클릭 시 팝업 닫기
  $("#cancelWithdraw").on("click", function(){
    $("#withdrawModal").hide();
    $("#withdrawForm")[0].reset(); // 입력값 초기화
  });

  // 3. 폼 제출(확인) 시 AJAX로 탈퇴 요청
  $("#withdrawForm").on("submit", function(e){
    e.preventDefault();

    // 입력값 가져오기
    var currentPass = $("input[name='currentPass']").val();
    var confirmPass = $("input[name='confirmPass']").val();

    // 1차 체크: 비밀번호 일치 확인
    if(currentPass !== confirmPass){
      alert("비밀번호가 일치하지 않습니다.");
      return;
    }

    // AJAX로 서버에 탈퇴 요청
    $.ajax({
      type: "POST",
      url: "/member/withdraw", // 컨트롤러 매핑에 맞춰서
      data: { currentPass: currentPass },
      success: function(result){
        if(result === "success"){
          alert("회원 탈퇴가 완료되었습니다.");
          window.location.href = "/main"; // 탈퇴 후 이동할 페이지
        }else if(result === "fail"){
          alert("비밀번호가 틀립니다.");
        }else{
          alert("오류가 발생했습니다. 다시 시도해주세요.");
        }
      },
      error: function(){
        alert("요청 처리 중 오류가 발생했습니다.");
      }
    });
  });
});
</script>
<!-- 이슬면접관 마이페이지 -->
<!-- ✅ 일정 관리 fragment 로드 -->
  <script>
    $(function() {
      $("#menuSchedule").on("click", function(e) {
        e.preventDefault();

        // 기존 active 제거 후 현재 메뉴에 적용
        $(".sidebar-menu a").removeClass("active");
        $(this).addClass("active");

        // fragment 로드
        $("#contentArea").load("/reservation/intrmypage", function(response, status, xhr) {
          if (status === "success") {
            console.log("✅ fragment 로드 성공");

            // flatpickr 초기화
            flatpickr("#datePicker", {
              dateFormat: "Y-m-d",
              minDate: "today"
            });
          } else {
            console.error("❌ fragment 로드 실패", status, xhr.status, xhr.statusText);
          }
        });
      });
    });
  </script>
</body>
</html>