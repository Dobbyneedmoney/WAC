<div th:fragment="fragment" class="reservation-list">
	<!-- ✅ 1. 받은 예약 일정 -->
	<h2 class="reservation-title">예약 일정</h2>
	<table class="reservation-table">
		<thead>
			<tr>
				<th>예약번호</th>
				<th>회원 ID</th>
				<th>예약일</th>
				<th>예약시간</th>
				<th>예약 생성일</th>
				<th>상태</th>
			</tr>
		</thead>
		<tbody>
			<tr th:each="r : ${reservations}">
				<td th:text="${r.resId}">1</td>
				<td th:text="${r.memId}">mem01</td>
				<td th:text="${r.reservedDate}">2025-07-09</td>
				<td th:text="${r.reservedTime}">12:00</td>
				<td th:text="${#dates.format(r.resCreateDt, 'yyyy-MM-dd HH:mm')}">2025-07-06
					17:00</td>
				<td><span class="status"
					th:classappend="${r.resStatus=='pending'?'pending':r.resStatus=='confirmed'?'confirmed':r.resStatus=='cancelled'?'cancelled':''}"
					th:text="${r.resStatus=='pending'?'결제 전':r.resStatus=='confirmed'?'결제 완료':r.resStatus=='cancelled'?'취소됨':'알 수 없음'}">
				</span></td>
			</tr>
		</tbody>
	</table>


	<!-- ✅ 2. 비활성화된 날짜/시간 -->
	<h2>비활성화한 시간</h2>
	<table class="reservation-table">
		<thead>
			<tr>
				<th>날짜</th>
				<th>시간</th>
				<th>삭제</th>
			</tr>
		</thead>
		<tbody>
			<tr th:if="${#lists.isEmpty(disabledList)}">
				<td colspan="2">비활성화된 시간 없음</td>
			</tr>
			<tr th:each="d : ${disabledList}">
				<td th:text="${d.disabledDate}">2025-07-11</td>
				<td th:text="${d.disabledTime}">13:00</td>
				<td>
				<button type="button" class="btn-delete" th:data-id="${d.disId}">삭제</button>
				</td>
			</tr>
		</tbody>
	</table>

	<!-- ✅ 3. 비활성화 등록 폼 (달력) -->
	<h2>날짜/시간 비활성화 등록</h2>
	<form id="disableForm" th:action="@{/reservation/blockDate}"
		method="post">
		<label> 날짜: <input type="text" id="datePicker" name="date"
			required>
		</label> <label> 시간: <select name="time" required>
				<option value="">-- 시간 선택 --</option>
				<option value="09:00">09:00</option>
				<option value="10:00">10:00</option>
				<option value="11:00">11:00</option>
				<option value="11:00">12:00</option>
				<option value="13:00">13:00</option>
				<option value="14:00">14:00</option>
				<option value="15:00">15:00</option>
				<option value="15:00">16:00</option>
				<option value="15:00">17:00</option>
				<option value="15:00">18:00</option>
		</select>
		</label>
		<button type="submit" class="btn-delete">비활성화 등록</button>
	</form>

	<!--등록 -->
	<script>
	$(document).off("submit", "#disableForm").on("submit", "#disableForm", function(e) {
		  e.preventDefault();

		  const form = $(this);
		  const date = form.find("input[name='date']").val();
		  const time = form.find("select[name='time']").val();

		  $.ajax({
		    url: "/reservation/blockDate",
		    method: "POST",
		    data: { date, time },
		    success: function() {
		      // 등록 성공 시 다시 fragment 로드
		      $("#contentArea").load("/reservation/intrmypage", function() {
		        // flatpickr 다시 초기화
		        flatpickr("#datePicker", {
		          dateFormat: "Y-m-d",
		          minDate: "today"
		        });
		      });
		    },
		    error: function(xhr) {
		      if (xhr.status === 409) {
		        alert("이미 등록된 날짜+시간입니다!");
		      } else {
		        alert("등록 실패!");
		      }
		    }
		  });
		});

	</script>
	<script>
	$(document).off("click", ".delete-btn").on("click", ".delete-btn", function () {
		  const id = $(this).data("id");

		  if (!confirm("정말 삭제하시겠습니까?")) return;

		  $.ajax({
		    type: "POST",
		    url: "/reservation/deleteDisabled",
		    data: { id: id },
		    success: function () {
		      // fragment 다시 로드
		      $("#contentArea").load("/reservation/intrmypage", function () {
		        flatpickr("#datePicker", {
		          dateFormat: "Y-m-d",
		          minDate: "today"
		        });
		      });
		    },
		    error: function () {
		      alert("삭제 실패!");
		    }
		  });
		});

</script>



</div>